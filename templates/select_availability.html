<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Select Availability</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='calendar/calendar.css') }}">
  <script src="{{ url_for('static', filename='calendar/calendar.js') }}"></script>

</head>

<body>

  <h2>Select your availability</h2>

  <input id="emailInput" placeholder="Enter your email"
         style="padding:10px;font-size:16px;width:300px;">

  <div id="calendar"></div>

  <div id="selectedSlot" style="margin-top:20px;font-size:18px;color:#444;">
    No slot selected
  </div>

  <button id="submitBtn" disabled
          style="margin-top:20px;padding:10px 20px;font-size:16px;">
    Submit
  </button>

  <script src="{{ url_for('static', filename='calendar/calendar.js') }}"></script>

  <script>
    buildCalendar();

    submitBtn.onclick = async function () {
      const email = document.getElementById("emailInput").value;

      if (!email) {
        alert("Please enter your email.");
        return;
      }
      if (!selectedSlot) {
        alert("Select a time slot.");
        return;
      }

      const payload = {
        candidate_email: email,
        new_slots: selectedSlot.dataset.start + "/" + selectedSlot.dataset.end
      };

      const res = await fetch("/api/save_updated_availability", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const data = await res.json();

      if (data.status === "saved") {
        alert("Availability saved!");
        window.location.reload();
      } else {
        alert("Error: " + JSON.stringify(data));
      }
    };
  </script>

</body>
</html>
